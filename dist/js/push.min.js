(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.jQuery;var n=e.n(t);const r=window._;var s=e.n(r),a=Object.prototype.toString,o=Array.isArray||function(e){return"[object Array]"===a.call(e)};function i(e){return"function"==typeof e}function c(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function l(e,t){return null!=e&&"object"==typeof e&&t in e}var d=RegExp.prototype.test,u=/\S/;var p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},h=/\s*/,f=/\s+/,g=/\s*=/,v=/\s*\}/,y=/#|\^|\/|>|\{|&|=|!/;function m(e){this.string=e,this.tail=e,this.pos=0}function b(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function w(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}m.prototype.eos=function(){return""===this.tail},m.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},m.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},b.prototype.push=function(e){return new b(e,this)},b.prototype.lookup=function(e){var t,n,r,s=this.cache;if(s.hasOwnProperty(e))t=s[e];else{for(var a,o,c,d=this,u=!1;d;){if(e.indexOf(".")>0)for(a=d.view,o=e.split("."),c=0;null!=a&&c<o.length;)c===o.length-1&&(u=l(a,o[c])||(n=a,r=o[c],null!=n&&"object"!=typeof n&&n.hasOwnProperty&&n.hasOwnProperty(r))),a=a[o[c++]];else a=d.view[e],u=l(d.view,e);if(u){t=a;break}d=d.parent}s[e]=t}return i(t)&&(t=t.call(this.view)),t},w.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},w.prototype.parse=function(e,t){var n=this.templateCache,r=e+":"+(t||L.tags).join(":"),s=void 0!==n,a=s?n.get(r):void 0;return null==a&&(a=function(e,t){if(!e)return[];var n,r,s,a,i=!1,l=[],p=[],b=[],w=!1,C=!1,T="",k=0;function E(){if(w&&!C)for(;b.length;)delete p[b.pop()];else b=[];w=!1,C=!1}function x(e){if("string"==typeof e&&(e=e.split(f,2)),!o(e)||2!==e.length)throw new Error("Invalid tags: "+e);n=new RegExp(c(e[0])+"\\s*"),r=new RegExp("\\s*"+c(e[1])),s=new RegExp("\\s*"+c("}"+e[1]))}x(t||L.tags);for(var S,A,j,U,I,q,$=new m(e);!$.eos();){if(S=$.pos,j=$.scanUntil(n))for(var _=0,O=j.length;_<O;++_)a=U=j.charAt(_),function(e,t){return d.call(e,t)}(u,a)?(C=!0,i=!0,T+=" "):(b.push(p.length),T+=U),p.push(["text",U,S,S+1]),S+=1,"\n"===U&&(E(),T="",k=0,i=!1);if(!$.scan(n))break;if(w=!0,A=$.scan(y)||"name",$.scan(h),"="===A?(j=$.scanUntil(g),$.scan(g),$.scanUntil(r)):"{"===A?(j=$.scanUntil(s),$.scan(v),$.scanUntil(r),A="&"):j=$.scanUntil(r),!$.scan(r))throw new Error("Unclosed tag at "+$.pos);if(I=">"==A?[A,j,S,$.pos,T,k,i]:[A,j,S,$.pos],k++,p.push(I),"#"===A||"^"===A)l.push(I);else if("/"===A){if(!(q=l.pop()))throw new Error('Unopened section "'+j+'" at '+S);if(q[1]!==j)throw new Error('Unclosed section "'+q[1]+'" at '+S)}else"name"===A||"{"===A||"&"===A?C=!0:"="===A&&x(j)}if(E(),q=l.pop())throw new Error('Unclosed section "'+q[1]+'" at '+$.pos);return function(e){for(var t,n=[],r=n,s=[],a=0,o=e.length;a<o;++a)switch((t=e[a])[0]){case"#":case"^":r.push(t),s.push(t),r=t[4]=[];break;case"/":s.pop()[5]=t[2],r=s.length>0?s[s.length-1][4]:n;break;default:r.push(t)}return n}(function(e){for(var t,n,r=[],s=0,a=e.length;s<a;++s)(t=e[s])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(r.push(t),n=t));return r}(p))}(e,t),s&&n.set(r,a)),a},w.prototype.render=function(e,t,n,r){var s=this.getConfigTags(r),a=this.parse(e,s),o=t instanceof b?t:new b(t,void 0);return this.renderTokens(a,o,n,e,r)},w.prototype.renderTokens=function(e,t,n,r,s){for(var a,o,i,c="",l=0,d=e.length;l<d;++l)i=void 0,"#"===(o=(a=e[l])[0])?i=this.renderSection(a,t,n,r,s):"^"===o?i=this.renderInverted(a,t,n,r,s):">"===o?i=this.renderPartial(a,t,n,s):"&"===o?i=this.unescapedValue(a,t):"name"===o?i=this.escapedValue(a,t,s):"text"===o&&(i=this.rawValue(a)),void 0!==i&&(c+=i);return c},w.prototype.renderSection=function(e,t,n,r,s){var a=this,c="",l=t.lookup(e[1]);if(l){if(o(l))for(var d=0,u=l.length;d<u;++d)c+=this.renderTokens(e[4],t.push(l[d]),n,r,s);else if("object"==typeof l||"string"==typeof l||"number"==typeof l)c+=this.renderTokens(e[4],t.push(l),n,r,s);else if(i(l)){if("string"!=typeof r)throw new Error("Cannot use higher-order sections without the original template");null!=(l=l.call(t.view,r.slice(e[3],e[5]),(function(e){return a.render(e,t,n,s)})))&&(c+=l)}else c+=this.renderTokens(e[4],t,n,r,s);return c}},w.prototype.renderInverted=function(e,t,n,r,s){var a=t.lookup(e[1]);if(!a||o(a)&&0===a.length)return this.renderTokens(e[4],t,n,r,s)},w.prototype.indentPartial=function(e,t,n){for(var r=t.replace(/[^ \t]/g,""),s=e.split("\n"),a=0;a<s.length;a++)s[a].length&&(a>0||!n)&&(s[a]=r+s[a]);return s.join("\n")},w.prototype.renderPartial=function(e,t,n,r){if(n){var s=this.getConfigTags(r),a=i(n)?n(e[1]):n[e[1]];if(null!=a){var o=e[6],c=e[5],l=e[4],d=a;0==c&&l&&(d=this.indentPartial(a,l,o));var u=this.parse(d,s);return this.renderTokens(u,t,n,d,r)}}},w.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},w.prototype.escapedValue=function(e,t,n){var r=this.getConfigEscape(n)||L.escape,s=t.lookup(e[1]);if(null!=s)return"number"==typeof s&&r===L.escape?String(s):r(s)},w.prototype.rawValue=function(e){return e[1]},w.prototype.getConfigTags=function(e){return o(e)?e:e&&"object"==typeof e?e.tags:void 0},w.prototype.getConfigEscape=function(e){return e&&"object"==typeof e&&!o(e)?e.escape:void 0};var L={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){C.templateCache=e},get templateCache(){return C.templateCache}},C=new w;L.clearCache=function(){return C.clearCache()},L.parse=function(e,t){return C.parse(e,t)},L.render=function(e,t,n,r){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(o(s=e)?"array":typeof s)+'" was given as the first argument for mustache#render(template, view, partials)');var s;return C.render(e,t,n,r)},L.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return p[e]}))},L.Scanner=m,L.Context=b,L.Writer=w;const T=L,{document:k,dt:E}=window;let x={},S="";const A=s().memoize((e=>{const t=k.getElementById(e);return!!t&&(t.attributes.template?(T.parse(t.innerHTML),"mustache"):s().template(t.innerHTML,null,{evaluate:/<#([\s\S]+?)#>/g,interpolate:/{{{([\s\S]+?)}}}/g,escape:/{{([^}]+?)}}(?!})/g}))}));n()(window).on("load",(()=>{const e=k.querySelector("#wp-admin-bar-distributor #wp-admin-bar-distributor-placeholder"),t=k.querySelector("#distributor-push-wrapper");if(!e||!t)return;let r="",a="",o="",i="",c="",l="",d="",u="",p="",h="",f="",g="";e.appendChild(t);const v=k.createElement("div");v.id="distributor-overlay";const y=k.querySelector("#wp-admin-bar-distributor");function m(){i=t.querySelector(".new-connections-list"),null!==i&&(c=i.querySelectorAll(".add-connection"),s().each(c,(e=>{e.classList.contains("syndicated")&&(e.disabled=!0)})))}function b(e){t.classList.add("message-error"),g.innerText="",s().each(function(e){return s().isArray(e)?s().map(e,(function(e){return s().isString(e)?e:s().has(e,"message")?e.message:void 0})):[e]}(e),(function(e){const t=k.createElement("li");t.innerText=e,g.appendChild(t)}))}function w(){i.innerText="";const e=A("dt-add-connection");let t="";s().each(r,(n=>{if(""!==S){const e=n.name.replace(/[^0-9a-zA-Z ]+/,"").toLowerCase().match(S.toLowerCase()),t=n.url.replace(/https?:\/\//i,"").replace(/www/i,"").replace(/[^0-9a-zA-Z ]+/,"").toLowerCase().match(S.toLowerCase());if(!e&&!t)return}"mustache"===e?(x[n.type+n.id]?n.added=!0:n.added=!1,"internal"===n.type&&(n.internal=!0),t=T.render(k.getElementById("dt-add-connection").innerHTML,{connection:n})):t=e({connection:n,selectedConnections:x}),i.innerHTML+=t})),""===i.innerHTML&&(i.innerHTML='<p class="no-results">No results</p>'),"mustache"===e&&m()}function L(e){switch(e){case"addEmpty":a.classList.add("empty");break;case"removeEmpty":a.classList.remove("empty");break;case"allUnavailable":d.classList.add("unavailable");break;case"all":d.classList.remove("unavailable");break;case"noneUnavailable":u.classList.add("unavailable");break;case"none":u.classList.remove("unavailable")}}function C(){if(e.focus(),U(),t.classList.contains("loaded"))return;t.classList.remove("message-error"),t.classList.add("loaded");var v=new Array;n()("#bulk-edit").find("#bulk-titles button").each((function(){v.push(n()(this).attr("id").substring(1))})),console.log(v),v.length>0&&(E.postId=v[0]);const y={action:"dt_load_connections",loadConnectionsNonce:E.loadConnectionsNonce,postId:E.postId,posts_array:v},b=A("dt-show-connections"),L=!!E.usexhr&&{withCredentials:!0};n().ajax({url:E.ajaxurl,xhrFields:L,method:"post",data:y}).done((e=>{if(!e.success||!e.data)return t.classList.remove("loaded"),void t.classList.add("message-error");if(r=e.data,"mustache"===b){const e={connections:[]};s().each(r,(t=>{"internal"===t.type&&(t.internal=!0),e.connections.push(t)})),t.innerHTML=T.render(k.getElementById("dt-show-connections").innerHTML,{connections:e.connections,foundConnections:e.connections.length,showSearch:5<e.connections.length}),m()}else t.innerHTML=b({connections:r});a=t.querySelector(".connections-selected"),o=t.querySelector(".selected-connections-list"),i=t.querySelector(".new-connections-list"),d=t.querySelector(".selectall-connections"),u=t.querySelector(".selectno-connections"),p=k.getElementById("dt-connection-search"),h=k.getElementById("dt-post-status"),f=k.getElementById("dt-as-draft"),g=k.querySelector(".dt-error ul.details"),null!==i&&(c=i.querySelectorAll(".add-connection")),n()(p).on("keyup change",s().debounce((e=>{""===e.currentTarget.value&&w(),S=e.currentTarget.value.replace(/https?:\/\//i,"").replace(/www/i,"").replace(/[^0-9a-zA-Z ]+/,""),w()}),300)),s().each(c,(e=>{e.classList.contains("syndicated")||(d.classList.remove("unavailable"),l++)}))})).error((()=>{t.classList.remove("loaded"),t.classList.add("message-error")}))}y.parentNode.insertBefore(v,y.nextSibling);const j=k.querySelector("#wp-admin-bar-distributor > a");function U(){y.classList.contains("hover")||y.classList.contains("syncing")||k.body.classList.remove("is-showing-distributor")}j.addEventListener("keydown",(function(e){13===e.keyCode&&C()}),!1),k.body.classList.contains("is-fullscreen-mode")&&window.hoverintent(y,(function(){return null}),U).options({timeout:180}),j.addEventListener("touchstart",C,!1),j.addEventListener("mouseenter",C,!1),v.addEventListener("click",(function(){y.classList.contains("syncing")||(y.classList.contains("hover")&&(y.classList.remove("hover"),k.body.classList.remove("is-showing-distributor")),U())}),!0),n()(t).on("click",".syndicate-button",(()=>{if(y.classList.contains("syncing"))return;y.classList.add("syncing");var e=new Array;n()("#bulk-edit").find("#bulk-titles button").each((function(){e.push(n()(this).attr("id").substring(1))})),0==e.length&&e.push(E.postId);const i={action:"dt_push",nonce:E.nonce,connections:x,postId:E.postId,postsarray:e};i.postStatus=null!==f&&f.checked?"draft":h.value;const c=!!E.usexhr&&{withCredentials:!0};n().ajax({url:E.ajaxurl,xhrFields:c,method:"post",data:i}).done((e=>{setTimeout((()=>{y.classList.remove("syncing"),U(),e.success?e.data&&e.data.results?function(e){let n=!1;const i={};["internal","external"].forEach((t=>{s().each(e[t],((e,a)=>{"success"===e.status&&(r[`${t}${a}`].syndicated=e.url,n=!0),s().isEmpty(e.errors)||(i[`${t}${a}`]=e.errors)}))})),s().isEmpty(i)||b(s().map(i,(function(e,t){return`${r[t].name}:\n${s().map(e,(function(e){return`- ${e}\n`}))}`}))),n&&s().isEmpty(i)&&(t.classList.add("message-success"),a.classList.add("empty"),o.innerText="",setTimeout((()=>{t.classList.remove("message-success")}),6e3)),x={},w()}(e.data.results):b(E.messages.empty_result):b(e.data)}),500)})).error(((e,t,n)=>{setTimeout((()=>{y.classList.remove("syncing"),b(`${E.messages.ajax_error} ${n}`)}),500)}))})),n()(t).on("click",".add-connection",(e=>{if("A"!==e.target.nodeName&&(e.preventDefault(),!e.currentTarget.classList.contains("syndicated")))if(e.currentTarget.classList.contains("added")){const t=e.currentTarget.getAttribute("data-connection-type"),n=e.currentTarget.getAttribute("data-connection-id"),r=o.querySelector(`[data-connection-id="${n}"][data-connection-type="${t}"]`);r.parentNode.removeChild(r),delete x[t+n],d.classList.contains("unavailable")&&L("all"),Object.keys(x).length||(L("addEmpty"),L("noneUnavailable")),w()}else{const t=e.currentTarget.getAttribute("data-connection-type"),n=e.currentTarget.getAttribute("data-connection-id");x[t+n]=r[t+n];const s=e.currentTarget.cloneNode(!0),a=k.createElement("span");a.classList.add("remove-connection"),s.appendChild(a),s.classList="added-connection",o.appendChild(s),u.classList.contains("unavailable")&&(L("removeEmpty"),L("none")),Object.keys(x).length==l&&L("allUnavailable"),w()}})),n()(t).on("click",".selectall-connections",(()=>{n()(i).children(".add-connection").each(((e,t)=>{if(t.classList.contains("syndicated")||t.classList.contains("added"))return;const n=t.getAttribute("data-connection-type"),s=t.getAttribute("data-connection-id");x[n+s]=r[n+s];const a=t.cloneNode();a.innerText=t.innerText;const i=k.createElement("span");i.classList.add("remove-connection"),a.appendChild(i),a.classList="added-connection",o.appendChild(a),""!==l&&(L("removeEmpty"),L("allUnavailable"),L("none"))})),w()})),n()(t).on("click",".selectno-connections",(()=>{for(;o.firstChild;){const e=o.firstChild.getAttribute("data-connection-type"),t=o.firstChild.getAttribute("data-connection-id");delete x[e+t],o.removeChild(o.firstChild)}""!==l&&(L("addEmpty"),L("noneUnavailable"),L("all")),w()})),n()(t).on("click",".added-connection",(e=>{e.currentTarget.parentNode.removeChild(e.currentTarget);const t=e.currentTarget.getAttribute("data-connection-type"),n=e.currentTarget.getAttribute("data-connection-id");delete x[t+n],d.classList.contains("unavailable")&&L("all"),Object.keys(x).length||(L("addEmpty"),L("noneUnavailable")),w()}))}))})();