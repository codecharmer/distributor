(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.jQuery;var n=e.n(t);const a=window._;var o=e.n(a);const r=window.wp.url,i=window.wp.a11y;function s(e,t){const n=c(e),a=c(t),o=n.pop(),r=a.pop(),i=_(n,a);return 0!==i?i:o&&r?_(o.split("."),r.split(".")):o||r?o?-1:1:0}const l=(e,t,n)=>{y(n);const a=s(e,t);return h[n].includes(a)};s.validate=e=>"string"==typeof e&&/^[v\d]/.test(e)&&d.test(e),s.compare=l,s.sastisfies=(e,t)=>{const n=t.match(/^([<>=~^]+)/),a=n?n[1]:"=";if("^"!==a&&"~"!==a)return l(e,t,a);const[o,r,i]=c(e),[s,d,u]=c(t);return 0===g(o,s)&&("^"===a?_([r,i],[d,u])>=0:0===g(r,d)&&g(i,u)>=0)};const d=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,c=e=>{if("string"!=typeof e)throw new TypeError("Invalid argument expected string");const t=e.match(d);if(!t)throw new Error(`Invalid argument not valid semver ('${e}' received)`);return t.shift(),t},u=e=>"*"===e||"x"===e||"X"===e,p=e=>{const t=parseInt(e,10);return isNaN(t)?e:t},g=(e,t)=>{if(u(e)||u(t))return 0;const[n,a]=((e,t)=>typeof e!=typeof t?[String(e),String(t)]:[e,t])(p(e),p(t));return n>a?1:n<a?-1:0},_=(e,t)=>{for(let n=0;n<Math.max(e.length,t.length);n++){const a=g(e[n]||0,t[n]||0);if(0!==a)return a}return 0},h={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]},m=Object.keys(h),y=e=>{if("string"!=typeof e)throw new TypeError("Invalid operator type, expected string but got "+typeof e);if(-1===m.indexOf(e))throw new Error(`Invalid operator, expected one of ${m.join("|")}`)},{ajaxurl:v,alert:b,document:f,dt:w,history:x}=window,{body:E}=f,I=f.getElementById("dt_external_connection_url"),k=f.getElementById("dt_external_connection_details"),B=f.getElementById("dt_external_connection_type"),T=f.getElementsByClassName("auth-field"),$=f.getElementsByClassName("dt-roles-allowed"),A=f.getElementById("title"),O=f.querySelector(".endpoint-result"),j=f.querySelector(".endpoint-errors"),z=f.getElementById("post_ID"),C=f.getElementById("create-connection"),N=f.getElementById("wpbody"),P=f.getElementById("dt_external_site_url"),D=f.getElementsByClassName("dt-wizard-error"),[S]=f.getElementsByClassName("dt-wizard-status"),q=f.getElementsByClassName("establish-connection-button"),L=f.getElementById("begin-authorization"),R=f.getElementById("create-oauth-connection"),Q=f.getElementsByClassName("manual-setup-button"),U=f.getElementById("#title-prompt-text"),F=B.value;let M=!1;function H(){if(!1!==M&&M.abort(),""===I.value)return j.innerText="",O.innerText="",void O.removeAttribute("data-endpoint-state");O.setAttribute("data-endpoint-state","loading"),O.innerText=w.endpoint_checking_message,j.innerText="";const e={};o().each(T,(t=>{if(t.disabled)return;const n=t.getAttribute("data-auth-field");n&&(e[n]=t.value)}));let t=0;z&&z.value&&(t=z.value),M=n().ajax({url:v,method:"post",data:{nonce:w.nonce,action:"dt_verify_external_connection",auth:e,url:I.value,type:B.value,endpointId:t}}).done((e=>{if(e.success)if(e.data.errors.no_external_connection)if(O.setAttribute("data-endpoint-state","error"),e.data.endpoint_suggestion){O.innerText=`${w.endpoint_suggestion} `;const t=f.createElement("button");t.classList.add("suggest"),t.classList.add("button-link"),t.setAttribute("type","button"),t.innerText=e.data.endpoint_suggestion,O.appendChild(t),(0,i.speak)(`${w.endpoint_suggestion} ${e.data.endpoint_suggestion}`,"polite")}else O.innerText=w.bad_connection,(0,i.speak)(w.bad_connection,"polite");else if(e.data.errors.no_distributor||!e.data.can_post.length){O.setAttribute("data-endpoint-state","warning"),O.innerText=w.limited_connection;const t=[];e.data.errors.no_distributor?(O.innerText+=` ${w.no_distributor}`,(0,i.speak)(`${w.limited_connection} ${w.no_distributor}`,"polite")):(0,i.speak)(`${w.limited_connection}`,"polite"),"no"===e.data.is_authenticated&&t.push(w.bad_auth),"yes"===e.data.is_authenticated&&t.push(w.no_permissions),t.push(w.no_push),t.push(w.pull_limited),t.forEach((e=>{const t=f.createElement("li");t.innerText=e,j.append(t)}))}else O.setAttribute("data-endpoint-state","valid"),O.innerText=w.good_connection,(0,i.speak)(w.good_connection,"polite");else O.setAttribute("data-endpoint-state","error")})).always((()=>{O.classList.remove("loading")}))}N.className=F,n()("#post").on("keypress",(function(e){return!(13===e.which&&!E.classList.contains("post-php")&&("wp"===n()(B).val()&&n()(q).trigger("click"),"wpdotcom"===n()(B).val()&&(ae(L)||n()(L).trigger("click"),ae(R)||n()(R).trigger("click")),1))})),n()(q).on("click",(e=>{e.preventDefault(),n()(D[0]).text("");const t=Z(n()(A),e),a=Z(n()(P),e);if(!t||!a)return e.preventDefault(),!1;let o=(0,r.prependHTTP)(P.value);return(0,r.isURL)(o)?(S.style.display="block",o=o.replace(/wp-json(\/)*/,""),o=o.replace(/\/?$/,"/"),n().ajax({url:v,method:"post",data:{nonce:w.nonce,action:"dt_get_remote_info",url:o}}).done((e=>{if(S.style.display="none",!e.success)return Object.prototype.hasOwnProperty.call(e,"data")&&Object.prototype.hasOwnProperty.call(e.data,"rest_url")&&!Object.prototype.hasOwnProperty.call(e.data,"version")?void n()(D[0]).text(w.no_distributor):(n()(D[0]).text(w.noconnection),void(Object.prototype.hasOwnProperty.call(e,"data")&&Array.isArray(e.data)&&0<e.data.length&&Object.prototype.hasOwnProperty.call(e.data[0],"code")&&Object.prototype.hasOwnProperty.call(e.data[0],"message")&&(n()(D[0]).append("<br/>"),e.data.forEach((e=>{n()(D[0]).append(`${e.message} ${e.code?`(${e.code})`:""} <br/>`)})))));if(s.compare(e.data.version,"1.6.0","<"))return void n()(D[0]).text(w.minversion);if("core_application_passwords_available"in e.data&&!e.data.core_application_passwords_available)return void n()(D[0]).text(w.application_passwords_not_available);const t=(0,r.addQueryArgs)(f.location.href,{setupStatus:"success",titleField:A.value,externalSiteUrlField:o,restRoot:e.data.rest_url}),a=(0,r.addQueryArgs)(f.location.href,{setupStatus:"failure"}),i="core_has_application_passwords"in e.data&&e.data.core_has_application_passwords?"authorize-application.php":"admin.php?page=auth_app";let l;l="core_application_passwords_endpoint"in e.data&&e.data.core_application_passwords_available?e.data.core_application_passwords_endpoint:`${o}wp-admin/${i}`;const d=(0,r.addQueryArgs)(l,{app_name:w.distributor_from,success_url:encodeURI(t),reject_url:encodeURI(a)});f.location=d})),!1):(n()(D[0]).text(w.invalid_url),!1)})),n()(Q).on("click",(e=>{e.preventDefault(),n()(".external-connection-wizard").hide(),n()(".external-connection-setup, .hide-until-authed").show()})),setTimeout((()=>{const{wizard_return:e}=w;e&&(""===A.value&&(n()(A).val(e.titleField).focus().blur(),n()(U).empty()),n()(G).val(e.user_login),n()(X).val(e.password),n()(I).val(e.restRoot),N.className="wizard-return",C.click()),H()}),300),n()(k).on("click",".suggest",(e=>{I.value=e.currentTarget.innerText,n()(I).trigger("input")})),n()(I).on("focus click",(e=>{e.target.setAttribute("initial-url",e.target.value)})),n()(I).on("keyup input",o().debounce((()=>{I.value.replace(/\/$/,"")!==I.getAttribute("initial-url").replace(/\/$/,"")&&(I.setAttribute("initial-url",I.value),H())}),250)),n()(I).on("blur",(e=>{""===A.value&&""!==e.currentTarget.value&&(A.value=e.currentTarget.value.replace(/https?:\/\//i,""),A.focus(),A.blur())}));const X=f.getElementById("dt_password"),G=f.getElementById("dt_username"),J=f.querySelector(".change-password");n()(G).on("focus click",(e=>{e.target.setAttribute("initial-username",e.target.value)})),n()(G).on("keyup input",o().debounce((()=>{G.getAttribute("initial-username")!==G.value&&J&&(X.disabled=!1,X.value="",J.style.display="none")}),250)),n()(X).on("keyup input",o().debounce((()=>{H()}),250)),n()(J).on("click",(e=>{e.preventDefault(),X.disabled?(X.disabled=!1,X.value="",e.currentTarget.innerText=w.cancel):(X.disabled=!0,X.value="sdfdsfsdfdsfdsfsd",e.currentTarget.innerText=w.change),H()})),n()($).on("click",".dt-role-checkbox",(e=>{e.target.classList.contains("dt-role-checkbox")&&e.target.checked&&"administrator"!==e.target.value&&"editor"!==e.target.value&&b(w.roles_warning)}));const K=n()(".hide-until-authed"),V=n()(f.getElementById("dt_client_secret")),W=n()(f.getElementById("dt_client_id")),Y=()=>{0===f.getElementsByClassName("oauth-connection-established").length&&K.hide()},Z=(e,t)=>""===e.val()?(t.preventDefault(),e.addClass("error-required"),!1):(e.removeClass("error-required"),!0);n()(B).on("change",(()=>{const e=B.value;N.className=e,"wp"===e?n()(".external-connection-wizard").show():n()(".external-connection-setup, .hide-until-authed").hide()})),"wpdotcom"===B.value&&Y(),R&&n()(R).on("click",(e=>{const t=Z(V,e),n=Z(W,e);if(!t||!n)return e.preventDefault(),!1}));const ee=f.getElementById("oauth-authentication-change-credentials"),te=n()(".oauth-authentication-details-wrapper");ee&&n()(ee).on("click",(function(){te.show(),V.val(""),n()(".oauth-connection-established").remove(),Y()}));const ne=f.getElementById("begin-authorization");function ae(e){return null===e.offsetParent}ne&&n()(ne).on("click",(e=>{const t=n()(A),a=t.val();Z(t,e)&&(n()(ne).addClass("disabled"),t.removeClass("error-required"),n().ajax({url:v,method:"post",data:{nonce:w.nonce,action:"dt_begin_authorization",title:a,id:n()(f.getElementById("post_ID")).val()}}).done((e=>{if(e.success&&e.data.id){const t=`${w.admin_url}post.php?post=${e.data.id}&action=edit`;x.pushState({},"Oauth Authorize Details",t),n()(f.getElementById("dt_redirect_uri")).val(t),n()(f.getElementById("dt_created_post_id")).val(e.data.id),n()(f.getElementById("original_post_status")).val("publish"),n()(".oauth-begin-authentication-wrapper").hide(),te.show()}})).always((()=>{n()(ne).removeClass("disabled")})))}))})();